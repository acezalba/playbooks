---
- name: Gather system facts
  ansible.builtin.gather_facts:
  register: host_system_facts

- name: Populate service facts
  ansible.builtin.service_facts:
  register: host_services_facts

- name: Pass datetime for use on filename
  shell: "date +%Y%m%d%H%M%S"
  register: datetime
  no_log: true

- name: Transform project name for templating
  ansible.builtin.set_fact:
    project_name_cleaned: "{{ project_name | trim() | lower() | replace(' ','_') }}"
  no_log: true

- name: Transform autogenerated values for project
  ansible.builtin.set_fact:
    site_title: "{{ project_name_cleaned | replace('_', ' ') | capitalize() }}"
    project_url: "{{ project_name_cleaned | replace('_', '') }}.test"
    site_password: "{{ lookup('password', '/dev/null chars=ascii_letters,digit length=30') | lower }}"
    current_path: "{{ lookup('env', 'PWD') }}"
  no_log: true

- name: Create a folder in the current working directory
  ansible.builtin.file:
    path: "{{ current_path }}/{{ project_name_cleaned }}"
    state: directory
  register: project_path

- name: Set directory loaded by the server application
  when: public_project_path is undefined
  ansible.builtin.set_fact:
    public_project_path: "{{ project_path.path }}/public"

- name: Set directory to symlink the project to
  when: symlink_project_path is undefined
  ansible.builtin.set_fact:
    symlink_project_path: "/var/www/html/{{ project_url }}"